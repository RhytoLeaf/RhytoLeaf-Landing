<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedScript</title>
    <link rel="icon" type="image/png" href="./images/speedscript-logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        :root {
            --rhytoleaf-green: #00CE7C;
        }

        [data-theme="dark"] {
            --background-rgb: 29, 30, 34;
            --text-color: white;
            --primary-rgb: 0, 206, 124;
        }

        [data-theme="light"] {
            --background-rgb: 245, 245, 220;
            --text-color: black;
            --primary-rgb: 0, 206, 124;
        }

        body {
            background-color: rgb(var(--background-rgb));
            color: var(--text-color);
            font-family: "Montserrat", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .quiz-container {
            text-align: center;
        }

        #quote-display {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }

        #dictation-board {
            width: 80%;
            height: 150px;
            font-size: 1.2rem;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid rgb(var(--primary-rgb));
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--text-color);
        }

        #timer {
            font-size: 2rem;
            margin-top: 2rem;
            color: var(--rhytoleaf-green);
        }

        #start-btn {
            background-color: var(--rhytoleaf-green);
            color: white;
            font-size: 1.2rem;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-top: 2rem;
        }
        
        #pass-btn {
            background-color: orange;
            color: white;
            font-size: 1.2rem;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-top: 2rem;
            margin-left: 1rem; /* To separate it from the start button */
        }
        
        .correct {
            color: var(--rhytoleaf-green);
        }

        #accuracy {
            font-size: 1.5rem;
            margin-top: 2rem;
            color: var(--rhytoleaf-green);
        }

        #score {
            font-size: 1.5rem;
            margin-top: 1rem;
            color: var(--text-color);
        }

        .logo-container {
            padding: 1rem;
        }

        .rhyto-logo {
            width: 50px;
            height: auto;
        }

        .modal-content {
            background-color: rgb(var(--background-rgb));
            color: var(--text-color);
        }

        .modal-header {
            border-bottom: 1px solid #444;
        }

        .modal-footer {
            border-top: 1px solid #444;
        }

        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            position: absolute;
            top: 1rem;
            right: 1rem;
        }
        .theme-switch {
            display: inline-block;
            height: 34px;
            position: relative;
            width: 60px;
        }

        .theme-switch input {
            display:none;
        }

        .slider {
            background-color: #ccc;
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
        }

        .slider:before {
            background-color: #fff;
            bottom: 4px;
            content: "";
            height: 26px;
            left: 4px;
            position: absolute;
            transition: .4s;
            width: 26px;
        }

        input:checked + .slider {
            background-color: var(--rhytoleaf-green);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        a {
            color: var(--rhytoleaf-green);
        }

        @media (max-width: 768px) and (orientation: portrait) {
            .quiz-container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            p {
                font-size: 0.9rem;
            }

            #quote-display {
                font-size: 1.2rem;
            }

            #dictation-board {
                width: 90%;
                height: 100px;
            }

            #timer {
                font-size: 1.5rem;
            }

            #start-btn {
                font-size: 1rem;
            }
        }

        footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox">
            <input type="checkbox" id="checkbox" />
            <div class="slider round"></div>
        </label>
    </div>
    <div class="logo-container text-center">
        <a href="#" data-bs-toggle="modal" data-bs-target="#homeModal">
            <img src="./images/logo-icon.png" alt="RhytoLeaf Logo" class="rhyto-logo">
        </a>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="homeModal" tabindex="-1" aria-labelledby="homeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="homeModalLabel">Return to Home</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to return to the home page? Your progress will be lost.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <a href="index.html" class="btn btn-primary">Return to Home</a>
                </div>
            </div>
        </div>
    </div>
    <div class="quiz-container">
        <h1>SpeedScript</h1>
        <p>Type the following quotes as fast and accurately as you can. <br><a href="#" data-bs-toggle="modal" data-bs-target="#whyModal">Why?</a></p>
        <div id="quote-display"></div>
        <textarea id="dictation-board" autofocus></textarea>
        <div id="timer">90.000</div>
        <div id="score">Score: 0</div>
        <button id="start-btn">Start</button>
        <button id="pass-btn">Pass</button>
    </div>

    <!-- Why Modal -->
    <div class="modal fade" id="whyModal" tabindex="-1" aria-labelledby="whyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="whyModalLabel">Why SpeedScript?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>This quiz helps you:</p>
                    <ul>
                        <li>Calculate your typing speed (WPM) in 90 seconds.</li>
                        <li>Improve typing accuracy and efficiency.</li>
                        <li>Enhance productivity and communication skills.</li>
                        <li>Focus on content, not just typing mechanics.</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <footer>
        <p>&copy; <span id="current-year"></span> RhytoLeaf Inc. All rights reserved.</p>
    </footer>
    <script>
        const quotes = [
            "The only way to do great work is to love what you do.",
            "Innovation distinguishes between a leader and a follower.",
            "Strive not to be a success, but rather to be of value.",
            "The mind is everything. What you think you become.",
            "An unexamined life is not worth living.",
            "The best way to predict the future is to create it.",
            "You miss 100% of the shots you don't take.",
            "The only thing we have to fear is fear itself.",
            "That's one small step for a man, one giant leap for mankind.",
            "In the end, it's not the years in your life that count. It's the life in your years.",
            "Do to others what you would have them do to you.",
            "The truth will set you free.",
            "Let the one who is without sin be the first to cast a stone.",
            "It is more blessed to give than to receive.",
            "A tree is known by its fruit.",
            "I say unto you, Love your enemies and pray for those who persecute you."
        ];

        const quoteDisplay = document.getElementById('quote-display');
        const dictationBoard = document.getElementById('dictation-board');
        const timerDisplay = document.getElementById('timer');
        const startBtn = document.getElementById('start-btn');
        const passBtn = document.getElementById('pass-btn');
        const accuracyDisplay = document.createElement('div');
        accuracyDisplay.id = 'accuracy';
        document.querySelector('.quiz-container').appendChild(accuracyDisplay);
        const scoreDisplay = document.getElementById('score');
        passBtn.disabled = true; // Disable pass button initially

        let timer;
        let timeLeft = 90;
        let quote = "";
        let quizQuotes = [];
        let totalChars = 0;
        let correctChars = 0;
        let score = 0; // Initialize score
        let startTime;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getQuizQuotes() {
            const uniqueQuotes = [...new Set(quotes)];
            if (uniqueQuotes.length < 5) {
                console.error("Not enough unique quotes to start the quiz.");
                return [];
            }
            const shuffledQuotes = shuffle(uniqueQuotes);
            return shuffledQuotes.slice(0, 5);
        }

        function startGame() {
            quizQuotes = getQuizQuotes();
            totalChars = 0;
            correctChars = 0;
            score = 0; // Reset score
            scoreDisplay.innerText = `Score: ${score}`; // Display initial score
            accuracyDisplay.innerText = '';
            dictationBoard.disabled = false;
            passBtn.disabled = false; // Enable pass button when game starts
            startTime = new Date();
            nextQuote();
            startTimer();
            startBtn.disabled = true;
        }

        function nextQuote() {
            if (quizQuotes.length === 0) {
                endGame();
                return;
            }
            quote = quizQuotes[0];
            quoteDisplay.innerHTML = '';
            quote.split('').forEach(character => {
                const span = document.createElement('span');
                span.innerText = character;
                quoteDisplay.appendChild(span);
            });
            dictationBoard.value = '';
            dictationBoard.focus();
        }

        function startTimer() {
            timeLeft = 90;
            timer = setInterval(() => {
                timeLeft -= 0.001;
                timerDisplay.innerText = `${timeLeft.toFixed(3)}s`;
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1);
        }

        function endGame(disqualified = false) {
            clearInterval(timer);
            dictationBoard.disabled = true;
            startBtn.disabled = false;
            passBtn.disabled = true; // Disable pass button when game ends
            if (disqualified) {
                accuracyDisplay.innerText = "Disqualified for cheating.";
            } else {
                const accuracy = totalChars > 0 ? (correctChars / totalChars) * 100 : 0;
                accuracyDisplay.innerText = `Accuracy: ${accuracy.toFixed(2)}%`;
            }
        }

        dictationBoard.addEventListener('paste', (e) => {
            e.preventDefault();
            endGame(true);
        });

        dictationBoard.addEventListener('input', () => {
            const quoteChars = quoteDisplay.querySelectorAll('span');
            const inputChars = dictationBoard.value.split('');

            totalChars = inputChars.length;
            correctChars = 0;

            let allCorrect = true;
            quoteChars.forEach((charSpan, index) => {
                const character = inputChars[index];
                if (character == null) {
                    charSpan.classList.remove('correct');
                    allCorrect = false;
                } else if (character === charSpan.innerText) {
                    charSpan.classList.add('correct');
                    correctChars++;
                } else {
                    charSpan.classList.remove('correct');
                    allCorrect = false;
                }
            });

            if (dictationBoard.value.length >= quote.length && allCorrect) {
                score++; // Increment score
                scoreDisplay.innerText = `Score: ${score}`; // Display updated score
                quizQuotes.shift(); // Remove the completed quote
                nextQuote();
            }

            // WPM calculation
            const timeElapsed = (new Date() - startTime) / 1000 / 60; // in minutes
            const wordsTyped = dictationBoard.value.length / 5; // average word length is 5
            const wpm = wordsTyped / timeElapsed;
            if (wpm > 200) {
                endGame(true);
            }
        });

        dictationBoard.addEventListener('keydown', (e) => {
            const input = dictationBoard.value;
            const currentInputLength = input.length;

            // Prevent typing incorrect characters
            const quoteUpToCurrentChar = quote.substring(0, currentInputLength);
            if (input !== quoteUpToCurrentChar) {
                if (e.key !== 'Backspace') {
                    e.preventDefault();
                }
            }

            // Prevent backspacing over correct characters
            if (e.key === 'Backspace' && currentInputLength > 0) {
                const charToDelete = input[currentInputLength - 1];
                const correspondingQuoteChar = quote[currentInputLength - 1];

                if (charToDelete === correspondingQuoteChar) {
                    e.preventDefault();
                }
            }
        });

        startBtn.addEventListener('click', startGame);

        passBtn.addEventListener('click', () => {
            if (quizQuotes.length > 0) {
                const passedQuote = quizQuotes.shift(); // Take the first quote
                quizQuotes.push(passedQuote); // Add it to the end
                nextQuote();
            }
        });

        const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');

        function switchTheme(e) {
            if (e.target.checked) {
                document.documentElement.setAttribute('data-theme', 'light');
            }
            else {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        toggleSwitch.addEventListener('change', switchTheme, false);

        document.addEventListener('DOMContentLoaded', (event) => {
            document.getElementById('current-year').textContent = new Date().getFullYear();
        });
    </script>
    <footer>
        <p>&copy; <span id="current-year"></span> RhytoLeaf Inc. All rights reserved.</p>
    </footer>
</body>
</html>