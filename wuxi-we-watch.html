<html lang="en">

<head>

    <link rel="icon" type="image/png" href="./images/logo-icon.png">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Wuxi we watch?</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;600&display=swap');

        body {
            font-family: "Montserrat", sans-serif;
        }
    </style>

</head>

<body class="bg-gray-800 text-white">

    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <img src="./images/wuxi-logo.png" alt="Wuxi Logo" class="w-1/3 mx-auto rounded-[22.5%]">
        </div>

        <header class="flex justify-center mb-8">
            <form id="form" class="w-full max-w-sm">
                <input type="text" id="search" placeholder="Search for a movie..." class="w-full bg-gray-700 text-white rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-green-500">
            </form>
        </header>

        <h1 class="text-3xl font-bold text-center mb-8">Recent Releases</h1>

        <main id="main" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></main>
    </div>

    <script>
        const APIURL =
            "https://api.themoviedb.org/3/discover/movie?sort_by=popularity.desc&api_key=04c35731a5ee918f014970082a0088b1&page=1";
        const IMGPATH = "https://image.tmdb.org/t/p/w1280";
        const SEARCHAPI =
            "https://api.themoviedb.org/3/search/movie?&api_key=04c35731a5ee918f014970082a0088b1&query=";

        const main = document.getElementById("main");
        const form = document.getElementById("form");
        const search = document.getElementById("search");

        // initially get fav movies
        getMovies(APIURL);

        async function getMovies(url) {
            const resp = await fetch(url);
            const respData = await resp.json();

            console.log(respData);

            showMovies(respData.results);
        }

        function showMovies(movies) {
            // clear main
            main.innerHTML = "";

            movies.forEach((movie) => {
                const { poster_path, title, vote_average, overview } = movie;

                const movieEl = document.createElement("div");
                movieEl.classList.add("bg-gray-700", "rounded-lg", "shadow-lg", "overflow-hidden", "relative", "group");

                movieEl.innerHTML = `
                    <img
                        src="${IMGPATH + poster_path}"
                        alt="${title}"
                        class="w-full"
                    />
                    <div class="p-4 flex justify-between items-center">
                        <h3 class="font-bold">${title}</h3>
                        <span class="font-bold py-1 px-2 rounded ${getClassByRate(
                            vote_average
                        )}">${vote_average}</span>
                    </div>
                    <div class="overview absolute top-0 left-0 w-full h-full bg-gray-800/80 text-white p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-in-out">
                        <h3 class="font-bold mb-2">Overview:</h3>
                        <p>${overview}</p>
                        <button class="read-aloud-btn bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full mt-4">Read Aloud</button>
                        <button class="stop-btn bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full mt-4 ml-2">Stop</button>
                    </div>
                `;

                const readAloudBtn = movieEl.querySelector(".read-aloud-btn");
                readAloudBtn.addEventListener("click", () => {
                    const utterance = new SpeechSynthesisUtterance(overview);
                    speechSynthesis.speak(utterance);
                });

                const stopBtn = movieEl.querySelector(".stop-btn");
                stopBtn.addEventListener("click", () => {
                    speechSynthesis.cancel();
                });

                main.appendChild(movieEl);
            });
        }

        function getClassByRate(vote) {
            if (vote >= 8) {
                return "bg-green-500";
            } else if (vote >= 5) {
                return "bg-orange-500";
            } else {
                return "bg-red-500";
            }
        }

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            const searchTerm = search.value;

            if (searchTerm) {
                getMovies(SEARCHAPI + searchTerm);

                search.value = "";
            }
        });
    </script>

</body>

</html>