<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cache Hax - Financial literacy exercise to help you manage your money wisely using the 50/35/5/10 budgeting rule.">
    <link rel="canonical" href="https://rhytoleaf.ca/apps/cachehax.html">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Cache Hax - Smart Money Management">
    <meta property="og:description" content="Master your finances with a personalized budgeting plan. Take the quiz and get your custom budget split.">
    <meta property="og:image" content="https://rhytoleaf.ca/images/cache-hax-logo.png">
    <meta property="og:url" content="https://rhytoleaf.ca/apps/cachehax.html">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cache Hax - Smart Money Management">
    <meta name="twitter:description" content="Master your finances with a personalized budgeting plan.">
    <meta name="twitter:image" content="https://rhytoleaf.ca/images/cache-hax-logo.png">
    <meta property="twitter:url" content="https://rhytoleaf.ca/apps/cachehax.html">

    <link rel="icon" type="image/png" href="../images/logo-icon.png">

    <title>Cache Hax - Smart Money Management</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --rhyto-green: #00CE7C;
            --rhyto-green-hover: #00b56d;
            --rhyto-green-dark: #009d5e;
            --fixed-costs: #FF6384;
            --guilt-free: #36A2EB;
            --savings: #FFCE56;
            --investments: #4BC0C0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #0a1014; /* Let the particle canvas handle the background */
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 65vh;
            min-height: 520px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            z-index: 1; /* Ensure hero content is above particles */
        }

        .hero-content {
            position: relative;
            z-index: 4;
            text-align: center;
            padding: 2rem;
        }

        .logo-container {
            margin-bottom: 2rem;
        }

        .app-logo {
            width: 140px;
            height: 140px;
            border-radius: 28%;
            box-shadow:
                0 16px 48px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.06),
                0 0 80px rgba(0, 206, 124, 0.15);
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.4s ease;
        }

        .app-logo:hover {
            transform: scale(1.06) translateY(-2px);
            box-shadow:
                0 24px 64px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.08),
                0 0 100px rgba(0, 206, 124, 0.2);
        }

        .hero h1 {
            font-family: 'DM Serif Display', serif;
            font-size: clamp(2.8rem, 5.5vw, 4.2rem);
            font-weight: 400;
            margin-bottom: 0.75rem;
            color: #fff;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 30px rgba(0, 0, 0, 0.4);
        }

        .hero p {
            font-size: clamp(0.95rem, 1.8vw, 1.15rem);
            color: rgba(255, 255, 255, 0.65);
            max-width: 460px;
            margin: 0 auto 2.25rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-btn:hover {
            background: var(--rhyto-green);
            color: white;
            text-decoration: none;
            transform: translateX(-5px);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 206, 124, 0.2);
        }

        /* Input Section */
        .input-section {
            margin: -5rem auto 4rem;
            max-width: 600px;
            position: relative;
            z-index: 2;
        }

        .input-group {
            margin-bottom: 2rem;
        }

        .input-group label {
            display: block;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--rhyto-green);
        }

        .input-group input {
            width: 100%;
            padding: 1.25rem;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--rhyto-green);
            box-shadow: 0 0 0 4px rgba(0, 206, 124, 0.2);
        }

        /* Disclaimer Button */
        .disclaimer-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.65rem 1.75rem;
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            letter-spacing: 0.02em;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .disclaimer-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Chart Section */
        .chart-section {
            margin: 4rem auto;
            text-align: center;
        }

        .chart-container {
            display: inline-block;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #pieChart {
            max-width: 400px;
            max-height: 400px;
        }

        /* Budget Cards */
        .budget-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 4rem auto;
        }

        .budget-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .budget-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .budget-card-header {
            padding: 1.5rem;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .budget-card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.9;
            z-index: -1;
        }
        
        .category-title {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .category-amount {
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            min-height: 1.2em; /* Prevent layout shift */
        }

        .percentage-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(0,0,0,0.2);
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            z-index: 1;
        }

        .percentage-input {
            width: 45px;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
            -moz-appearance: textfield;
        }
        
        .percentage-input::-webkit-outer-spin-button,
        .percentage-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .percentage-sign {
            font-size: 1.2rem;
            font-weight: 700;
            color: rgba(255,255,255,0.5);
        }

        .budget-card-header.fixed-costs::before {
            background: linear-gradient(135deg, var(--fixed-costs), #ff4081);
        }

        .budget-card-header.guilt-free::before {
            background: linear-gradient(135deg, var(--guilt-free), #1e88e5);
        }

        .budget-card-header.savings::before {
            background: linear-gradient(135deg, var(--savings), #ffa726);
        }

        .budget-card-header.investments::before {
            background: linear-gradient(135deg, var(--investments), #26a69a);
        }

        .budget-card-image {
            width: 100%;
            height: 140px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .budget-card-image i {
            font-size: 2.8rem;
            position: relative;
            z-index: 2;
            opacity: 0.7;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }

        .budget-card-image::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 0;
        }

        .budget-card-image::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.06'/%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 200px 200px;
            opacity: 0.4;
            z-index: 1;
            pointer-events: none;
        }

        /* Per-category card illustrations */
        .budget-card-image.img-fixed::before {
            background:
                radial-gradient(circle 80px at 30% 50%, rgba(255, 99, 132, 0.2) 0%, transparent 70%),
                radial-gradient(circle 60px at 70% 40%, rgba(255, 64, 129, 0.15) 0%, transparent 60%),
                linear-gradient(135deg, rgba(255, 99, 132, 0.08) 0%, rgba(15, 32, 39, 0.6) 100%);
        }

        .budget-card-image.img-guilt::before {
            background:
                radial-gradient(circle 80px at 70% 50%, rgba(54, 162, 235, 0.2) 0%, transparent 70%),
                radial-gradient(circle 60px at 25% 60%, rgba(30, 136, 229, 0.15) 0%, transparent 60%),
                linear-gradient(135deg, rgba(54, 162, 235, 0.08) 0%, rgba(15, 32, 39, 0.6) 100%);
        }

        .budget-card-image.img-savings::before {
            background:
                radial-gradient(circle 80px at 50% 40%, rgba(255, 206, 86, 0.2) 0%, transparent 70%),
                radial-gradient(circle 60px at 30% 70%, rgba(255, 167, 38, 0.15) 0%, transparent 60%),
                linear-gradient(135deg, rgba(255, 206, 86, 0.08) 0%, rgba(15, 32, 39, 0.6) 100%);
        }

        .budget-card-image.img-invest::before {
            background:
                radial-gradient(circle 80px at 60% 55%, rgba(75, 192, 192, 0.2) 0%, transparent 70%),
                radial-gradient(circle 60px at 35% 35%, rgba(38, 166, 154, 0.15) 0%, transparent 60%),
                linear-gradient(135deg, rgba(75, 192, 192, 0.08) 0%, rgba(15, 32, 39, 0.6) 100%);
        }

        .budget-card-body {
            padding: 1.5rem;
        }

        .budget-card-body ul {
            list-style: none;
            padding: 0;
        }

        .budget-card-body li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .budget-card-body li:last-child {
            border-bottom: none;
        }

        .budget-card-body li i {
            color: var(--rhyto-green);
            font-size: 1.1rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            background: linear-gradient(135deg, #0f2027, #203a43);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--rhyto-green);
            margin: 0;
            font-size: 1.5rem;
        }

        .close {
            color: #aaa;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: var(--rhyto-green);
        }

        .modal-body {
            padding: 2rem;
            line-height: 1.8;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: right;
        }

        .modal-footer button {
            padding: 0.75rem 2rem;
            background: var(--rhyto-green);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-footer button:hover {
            background: var(--rhyto-green-hover);
            transform: scale(1.05);
        }

        /* ============ QUIZ SECTION ============ */
        .quiz-section {
            margin: -5rem auto 4rem;
            max-width: 640px;
            position: relative;
            z-index: 2;
        }

        .quiz-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 3rem 2.5rem 2.5rem;
            box-shadow:
                0 4px 24px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(0, 206, 124, 0.05) inset;
            position: relative;
            overflow: hidden;
        }

        /* Subtle decorative gradient wash across top */
        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--fixed-costs), var(--guilt-free), var(--savings), var(--investments));
            opacity: 0.8;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 2.25rem;
        }

        .quiz-header h2 {
            font-family: 'DM Serif Display', serif;
            font-size: 1.75rem;
            font-weight: 400;
            color: #fff;
            margin-bottom: 0.6rem;
            letter-spacing: -0.01em;
        }

        .quiz-header p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.02em;
        }

        /* ---- Progress Bar (segmented) ---- */
        .quiz-progress {
            display: flex;
            gap: 6px;
            margin-bottom: 2.5rem;
            padding: 0 0.5rem;
        }

        .quiz-progress-seg {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.08);
            overflow: hidden;
            position: relative;
        }

        .quiz-progress-seg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            border-radius: 2px;
            background: var(--rhyto-green);
            transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .quiz-progress-seg.completed::after { width: 100%; }
        .quiz-progress-seg.active::after {
            width: 100%;
            background: linear-gradient(90deg, var(--rhyto-green), rgba(0, 206, 124, 0.4));
            animation: progressPulse 1.5s ease-in-out infinite;
        }

        @keyframes progressPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ---- Step Counter ---- */
        .quiz-step-label {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.3);
            margin-bottom: 1.75rem;
        }

        .quiz-step-label span {
            color: var(--rhyto-green);
        }

        /* ---- Question ---- */
        .quiz-question-wrap {
            animation: quizFadeSlideIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        @keyframes quizFadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quiz-question {
            font-family: 'DM Serif Display', serif;
            font-size: 1.3rem;
            font-weight: 400;
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.95);
        }

        /* ---- Options ---- */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .quiz-option {
            position: relative;
            padding: 1rem 1.25rem 1rem 3rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.07);
            border-radius: 14px;
            color: rgba(255, 255, 255, 0.85);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s cubic-bezier(0.22, 1, 0.36, 1);
            opacity: 0;
            transform: translateY(8px);
            animation: optionReveal 0.35s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        .quiz-option:nth-child(1) { animation-delay: 0.08s; }
        .quiz-option:nth-child(2) { animation-delay: 0.14s; }
        .quiz-option:nth-child(3) { animation-delay: 0.20s; }
        .quiz-option:nth-child(4) { animation-delay: 0.26s; }

        @keyframes optionReveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Letter badge */
        .quiz-option::before {
            content: attr(data-letter);
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0;
            color: rgba(255, 255, 255, 0.4);
            transition: all 0.2s ease;
        }

        .quiz-option:hover {
            background: rgba(0, 206, 124, 0.06);
            border-color: rgba(0, 206, 124, 0.25);
            color: #fff;
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .quiz-option:hover::before {
            background: rgba(0, 206, 124, 0.12);
            border-color: rgba(0, 206, 124, 0.3);
            color: var(--rhyto-green);
        }

        .quiz-option.selected {
            background: rgba(0, 206, 124, 0.1);
            border-color: var(--rhyto-green);
            color: #fff;
            box-shadow: 0 0 20px rgba(0, 206, 124, 0.1);
        }

        .quiz-option.selected::before {
            background: var(--rhyto-green);
            border-color: var(--rhyto-green);
            color: #fff;
        }

        /* ---- Results Screen ---- */
        .quiz-results {
            text-align: center;
            animation: quizFadeSlideIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        .quiz-results h3 {
            font-family: 'DM Serif Display', serif;
            font-size: 1.5rem;
            font-weight: 400;
            color: #fff;
            margin-bottom: 0.4rem;
        }

        .quiz-results-subtitle {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 2.25rem;
            font-weight: 500;
        }

        /* Result ring grid */
        .results-ring-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 2.5rem;
        }

        .result-ring-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.6rem;
            opacity: 0;
            transform: scale(0.8);
            animation: ringReveal 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        .result-ring-item:nth-child(1) { animation-delay: 0.1s; }
        .result-ring-item:nth-child(2) { animation-delay: 0.2s; }
        .result-ring-item:nth-child(3) { animation-delay: 0.3s; }
        .result-ring-item:nth-child(4) { animation-delay: 0.4s; }

        @keyframes ringReveal {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .result-ring-svg {
            width: 90px;
            height: 90px;
            transform: rotate(-90deg);
        }

        .result-ring-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.06);
            stroke-width: 5;
        }

        .result-ring-fill {
            fill: none;
            stroke-width: 5;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .result-ring-pct {
            font-size: 1.4rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .result-ring-label {
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.45);
        }

        /* Bars as thin accent under rings */
        .results-bars-mini {
            display: flex;
            gap: 4px;
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.04);
        }

        .results-bar-seg {
            height: 100%;
            transition: width 1s cubic-bezier(0.22, 1, 0.36, 1);
            border-radius: 3px;
        }

        .results-bar-seg.fixed { background: var(--fixed-costs); }
        .results-bar-seg.guilt-free { background: var(--guilt-free); }
        .results-bar-seg.savings { background: var(--savings); }
        .results-bar-seg.investments { background: var(--investments); }

        /* Buttons */
        .quiz-apply-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.85rem 2.25rem;
            background: var(--rhyto-green);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 4px 16px rgba(0, 206, 124, 0.25);
        }

        .quiz-apply-btn:hover {
            background: var(--rhyto-green-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 206, 124, 0.3);
        }

        .retake-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1.25rem;
            background: transparent;
            color: rgba(255, 255, 255, 0.35);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.75rem;
            letter-spacing: 0.03em;
            cursor: pointer;
            transition: all 0.25s ease;
            margin-top: 0.75rem;
        }

        .retake-btn:hover {
            color: var(--rhyto-green);
            border-color: rgba(0, 206, 124, 0.3);
            background: rgba(0, 206, 124, 0.04);
        }

        .budget-content { display: none; }
        .budget-content.visible { display: block; }

        @media (max-width: 768px) {
            .quiz-card { padding: 2rem 1.5rem 2rem; }

            .results-ring-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
            }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 2rem;
            margin-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .back-btn {
                top: 1rem;
                left: 1rem;
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }

            .hero {
                height: 55vh;
                min-height: 420px;
            }

            .hero-glow {
                width: 280px;
                height: 280px;
            }

            .budget-cards {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .modal-content {
                margin: 10% 1rem;
            }
        }
    </style>
</head>

<body>

    <div id="particles-js"></div>

    <!-- Back to All Apps Navigation -->
    <a href="../index.html#apps" style="display:inline-flex;align-items:center;gap:0.4rem;padding:0.6rem 1rem;font-size:0.85rem;font-weight:500;color:#7A8B9C;text-decoration:none;position:fixed;top:1rem;left:1rem;z-index:100;transition:color 0.2s;" onmouseover="this.style.color='#00CE7C'" onmouseout="this.style.color='#7A8B9C'">
      <i class="fas fa-arrow-left" style="font-size:0.75rem;"></i> All Apps
    </a>

    <!-- Back to Home Button -->
    <a href="../index.html" class="back-btn" aria-label="Back to home">
        <i class="fas fa-arrow-left"></i>
        <span>Back to Home</span>
    </a>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="logo-container">
                <img src="../images/cache-hax-logo.png" alt="Cache Hax Logo" class="app-logo">
            </div>
            <h1>Cache Hax</h1>
            <p>Master your finances with a personalized budgeting plan</p>
            <button class="disclaimer-btn" onclick="openModal()">
                <i class="fas fa-info-circle"></i> Important Disclaimer
            </button>
        </div>
    </section>

    <div class="container">
        <!-- Quiz Section -->
        <section class="quiz-section" id="quizSection">
            <div class="quiz-card">
                <div class="quiz-header">
                    <h2>Budget Profile Quiz</h2>
                    <p>5 questions. Your personalized budget split.</p>
                </div>
                <div class="quiz-progress" id="quizProgress"></div>
                <div class="quiz-step-label" id="quizStepLabel"></div>
                <div id="quizBody"></div>
            </div>
        </section>

        <!-- Budget Content (hidden until quiz complete) -->
        <div class="budget-content" id="budgetContent">

        <!-- Input Section -->
        <section class="input-section">
            <div class="glass-card">
                <div class="input-group">
                    <label for="salaryProfit">
                        <i class="fas fa-dollar-sign"></i> Enter Your Monthly Profit
                    </label>
                    <input type="number" id="salaryProfit" placeholder="0.00" min="0" step="0.01" aria-label="Monthly profit input">
                </div>
            </div>
        </section>

        <!-- Chart Section -->
        <section class="chart-section">
            <h2 style="margin-bottom: 2rem; font-size: 2rem; color: var(--rhyto-green);">Your Budget Breakdown</h2>
            <div class="chart-container">
                <canvas id="pieChart"></canvas>
            </div>
        </section>

        <!-- Budget Cards -->
        <section class="budget-cards">
            <!-- Fixed Costs -->
            <div class="budget-card">
                <div class="budget-card-header fixed-costs">
                    <span class="category-title">Fixed Costs</span>
                    <div class="percentage-input-wrapper">
                        <input type="number" class="percentage-input" data-key="fixed" min="0" max="100">
                        <span class="percentage-sign">%</span>
                    </div>
                    <span class="category-amount" id="fixed-amount"></span>
                </div>
                <div class="budget-card-image img-fixed">
                    <i class="fas fa-home"></i>
                </div>
                <div class="budget-card-body">
                    <ul>
                        <li><i class="fas fa-credit-card"></i> Debt payments</li>
                        <li><i class="fas fa-file-invoice-dollar"></i> Bills & Utilities</li>
                        <li><i class="fas fa-shield-alt"></i> Insurance</li>
                        <li><i class="fas fa-shopping-cart"></i> Groceries</li>
                    </ul>
                </div>
            </div>

            <!-- Guilt-free Spending -->
            <div class="budget-card">
                <div class="budget-card-header guilt-free">
                    <span class="category-title">Guilt-free</span>
                    <div class="percentage-input-wrapper">
                        <input type="number" class="percentage-input" data-key="guiltFree" min="0" max="100">
                        <span class="percentage-sign">%</span>
                    </div>
                    <span class="category-amount" id="guiltFree-amount"></span>
                </div>
                <div class="budget-card-image img-guilt">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="budget-card-body">
                    <ul>
                        <li><i class="fas fa-heart"></i> Passion projects</li>
                        <li><i class="fas fa-utensils"></i> Dining out</li>
                        <li><i class="fas fa-film"></i> Entertainment</li>
                        <li><i class="fas fa-tag"></i> Shopping</li>
                    </ul>
                </div>
            </div>

            <!-- Savings -->
            <div class="budget-card">
                <div class="budget-card-header savings">
                    <span class="category-title">Savings</span>
                     <div class="percentage-input-wrapper">
                        <input type="number" class="percentage-input" data-key="savings" min="0" max="100">
                        <span class="percentage-sign">%</span>
                    </div>
                    <span class="category-amount" id="savings-amount"></span>
                </div>
                <div class="budget-card-image img-savings">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <div class="budget-card-body">
                    <ul>
                        <li><i class="fas fa-life-ring"></i> Emergency fund</li>
                        <li><i class="fas fa-car"></i> Large purchases</li>
                        <li><i class="fas fa-plane"></i> Vacation plans</li>
                        <li><i class="fas fa-school"></i> Education</li>
                    </ul>
                </div>
            </div>

            <!-- Investments -->
            <div class="budget-card">
                <div class="budget-card-header investments">
                    <span class="category-title">Investments</span>
                     <div class="percentage-input-wrapper">
                        <input type="number" class="percentage-input" data-key="investments" min="0" max="100">
                        <span class="percentage-sign">%</span>
                    </div>
                    <span class="category-amount" id="investments-amount"></span>
                </div>
                <div class="budget-card-image img-invest">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="budget-card-body">
                    <ul>
                        <li><i class="fas fa-chart-pie"></i> Index Funds (ETFs)</li>
                        <li><i class="fas fa-building"></i> Real Estate</li>
                        <li><i class="fas fa-hand-holding-usd"></i> Retirement Accounts</li>
                        <li><i class="fas fa-seedling"></i> Stock Market</li>
                    </ul>
                </div>
            </div>
        </section>

        </div><!-- /budget-content -->
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Financial Literacy Exercise</h2>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>
                    Please be aware that financial markets and regulations can change rapidly, and the
                    information provided may become outdated. It is your responsibility to verify and update any
                    information before making financial decisions.
                </p>
                <p>
                    By engaging in any discussion or receiving information from this tool, you acknowledge and agree to
                    these terms and release RhytoLeaf Inc. from any and all liability, claims, or damages arising from or in
                    connection with the use of the information provided.
                </p>
                <p>
                    If you require personalized financial advice, it is strongly advised to consult with a
                    qualified financial professional who can assess your individual situation and provide
                    appropriate guidance.
                </p>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2026 RhytoLeaf Inc. All rights reserved.</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    <script>
    (async () => {
        await tsParticles.load("particles-js", {
            fullScreen: {
                enable: false
            },
            background: {
                color: {
                    value: "transparent"
                }
            },
            particles: {
                number: {
                    value: 25,
                    density: {
                        enable: true,
                        area: 800
                    }
                },
                shape: {
                    type: "image",
                    options: {
                        image: {
                            src: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Bitcoin.svg/2048px-Bitcoin.svg.png",
                            width: 100,
                            height: 100,
                            replaceColor: false
                        }
                    }
                },
                opacity: {
                    value: 0.6
                },
                size: {
                    value: { min: 14, max: 30 }
                },
                move: {
                    enable: true,
                    speed: 1.5,
                    direction: "bottom",
                    random: true,
                    straight: false,
                    outModes: {
                        default: "out"
                    }
                },
                rotate: {
                    value: { min: 0, max: 360 },
                    direction: "random",
                    animation: {
                        enable: true,
                        speed: 10,
                        sync: false
                    }
                },
                tilt: {
                    enable: true,
                    value: { min: -20, max: 20 },
                    direction: "random",
                    animation: {
                        enable: true,
                        speed: 5,
                        sync: false
                    }
                }
            },
            interactivity: {
                detectsOn: "window",
                events: {
                    onHover: {
                        enable: true,
                        mode: "repulse"
                    },
                    onClick: {
                        enable: true,
                        mode: "push"
                    },
                    resize: true
                },
                modes: {
                    repulse: {
                        distance: 100,
                        duration: 0.4
                    },
                    push: {
                        quantity: 4
                    }
                }
            },
            detectRetina: true
        });
    })();
    </script>

    <script>
        // ============ MODAL ============
        function openModal() {
            document.getElementById('myModal').style.display = 'block';
        }
        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }
        window.onclick = function(event) {
            if (event.target === document.getElementById('myModal')) closeModal();
        }

        // ============ QUIZ DATA ============
        const quizData = [
            {
                question: "What best describes your current living situation?",
                options: [
                    { text: "I rent and live alone", deltas: { fixed: 5, guiltFree: 0, savings: -3, investments: -2 } },
                    { text: "I rent with roommates or shared housing", deltas: { fixed: 0, guiltFree: 2, savings: 0, investments: -2 } },
                    { text: "I own my home (with a mortgage)", deltas: { fixed: 3, guiltFree: -2, savings: -2, investments: 1 } },
                    { text: "I live with family / no housing costs", deltas: { fixed: -12, guiltFree: 4, savings: 4, investments: 4 } }
                ]
            },
            {
                question: "How would you describe your current debt?",
                options: [
                    { text: "Significant debt (student loans, credit cards, car payments)", deltas: { fixed: 8, guiltFree: -4, savings: -2, investments: -2 } },
                    { text: "Some manageable debt (one loan or small balance)", deltas: { fixed: 3, guiltFree: -1, savings: -1, investments: -1 } },
                    { text: "Minimal or no debt", deltas: { fixed: -5, guiltFree: 1, savings: 2, investments: 2 } }
                ]
            },
            {
                question: "What\u2019s your top financial priority right now?",
                options: [
                    { text: "Paying off debt as fast as possible", deltas: { fixed: 5, guiltFree: -3, savings: -1, investments: -1 } },
                    { text: "Building an emergency fund", deltas: { fixed: -2, guiltFree: -2, savings: 6, investments: -2 } },
                    { text: "Enjoying life and experiences", deltas: { fixed: -2, guiltFree: 6, savings: -2, investments: -2 } },
                    { text: "Growing wealth long-term", deltas: { fixed: -2, guiltFree: -3, savings: -1, investments: 6 } }
                ]
            },
            {
                question: "How do you typically handle extra money at the end of the month?",
                options: [
                    { text: "I usually spend it on things I enjoy", deltas: { fixed: 0, guiltFree: 5, savings: -3, investments: -2 } },
                    { text: "I save it for a rainy day", deltas: { fixed: 0, guiltFree: -2, savings: 5, investments: -3 } },
                    { text: "I invest or put it toward financial goals", deltas: { fixed: 0, guiltFree: -2, savings: -3, investments: 5 } },
                    { text: "It usually goes to bills or catching up", deltas: { fixed: 5, guiltFree: -2, savings: -2, investments: -1 } }
                ]
            },
            {
                question: "How comfortable are you with investing your money?",
                options: [
                    { text: "Very comfortable \u2014 I\u2019d invest aggressively", deltas: { fixed: 0, guiltFree: -2, savings: -3, investments: 5 } },
                    { text: "Somewhat comfortable \u2014 balanced approach", deltas: { fixed: 0, guiltFree: 0, savings: -1, investments: 1 } },
                    { text: "Not very \u2014 I prefer keeping money safe", deltas: { fixed: 0, guiltFree: 0, savings: 4, investments: -4 } },
                    { text: "I haven\u2019t started thinking about it yet", deltas: { fixed: 0, guiltFree: 0, savings: 0, investments: 0 } }
                ]
            }
        ];

        const LETTERS = ['A', 'B', 'C', 'D'];
        const CATEGORY_META = [
            { key: 'fixed', name: 'Fixed Costs', color: '#FF6384' },
            { key: 'guiltFree', name: 'Guilt-free Spending', color: '#36A2EB' },
            { key: 'savings', name: 'Savings', color: '#FFCE56' },
            { key: 'investments', name: 'Investments', color: '#4BC0C0' }
        ];

        // ============ QUIZ STATE ============
        let currentQuestionIndex = 0;
        let quizAnswers = [];
        let budgetWeights = { fixed: 50, guiltFree: 30, savings: 10, investments: 10 };
        const MIN_PERCENTAGE = 5;

        // ============ QUIZ FUNCTIONS ============
        function initQuiz() {
            currentQuestionIndex = 0;
            quizAnswers = [];
            document.getElementById('quizSection').style.display = '';
            document.getElementById('budgetContent').classList.remove('visible');
            renderProgress();
            renderStepLabel();
            renderQuestion();
        }

        function renderProgress() {
            const container = document.getElementById('quizProgress');
            container.innerHTML = '';
            for (let i = 0; i < quizData.length; i++) {
                const seg = document.createElement('div');
                seg.className = 'quiz-progress-seg';
                if (i < currentQuestionIndex) seg.classList.add('completed');
                if (i === currentQuestionIndex) seg.classList.add('active');
                container.appendChild(seg);
            }
        }

        function renderStepLabel() {
            const label = document.getElementById('quizStepLabel');
            if (currentQuestionIndex < quizData.length) {
                label.innerHTML = `Question <span>${currentQuestionIndex + 1}</span> of ${quizData.length}`;
                label.style.display = '';
            } else {
                label.style.display = 'none';
            }
        }

        function renderQuestion() {
            const body = document.getElementById('quizBody');
            const q = quizData[currentQuestionIndex];
            let html = '<div class="quiz-question-wrap">';
            html += `<div class="quiz-question">${q.question}</div>`;
            html += '<div class="quiz-options">';
            q.options.forEach((opt, i) => {
                html += `<button class="quiz-option" data-letter="${LETTERS[i]}" onclick="selectAnswer(${i})">${opt.text}</button>`;
            });
            html += '</div></div>';

            body.innerHTML = html;
        }

        function selectAnswer(answerIndex) {
            quizAnswers[currentQuestionIndex] = answerIndex;
            const options = document.querySelectorAll('.quiz-option');
            options[answerIndex].classList.add('selected');
            options.forEach(btn => btn.style.pointerEvents = 'none');
            setTimeout(() => {
                currentQuestionIndex++;
                renderProgress();
                renderStepLabel();
                if (currentQuestionIndex < quizData.length) {
                    renderQuestion();
                } else {
                    showResults();
                }
            }, 300);
        }

        function calculateWeights() {
            const base = { fixed: 50, guiltFree: 30, savings: 10, investments: 10 };
            const minimums = { fixed: 30, guiltFree: 10, savings: 5, investments: 5 };
            const keys = CATEGORY_META.map(c => c.key);

            quizAnswers.forEach((ansIdx, qIdx) => {
                const d = quizData[qIdx].options[ansIdx].deltas;
                keys.forEach(k => base[k] += d[k]);
            });

            keys.forEach(k => { if (base[k] < minimums[k]) base[k] = minimums[k]; });

            const total = keys.reduce((s, k) => s + base[k], 0);
            keys.forEach(k => base[k] = Math.round((base[k] / total) * 100));

            const rTotal = keys.reduce((s, k) => s + base[k], 0);
            if (rTotal !== 100) {
                const largest = keys.reduce((a, b) => base[a] >= base[b] ? a : b);
                base[largest] += (100 - rTotal);
            }
            return base;
        }

        function showResults() {
            budgetWeights = calculateWeights();
            renderProgress();
            renderStepLabel();
            const body = document.getElementById('quizBody');
            let ringsHtml = '';
            CATEGORY_META.forEach(cat => {
                const pct = budgetWeights[cat.key];
                ringsHtml += `<div class="result-ring-item">
                        ${makeRing(pct, cat.color)}
                        <span class="result-ring-pct" style="color:${cat.color}" data-target="${pct}">0</span>
                        <span class="result-ring-label">${cat.name}</span>
                    </div>`;
            });
            let barsHtml = '';
            CATEGORY_META.forEach(cat => {
                barsHtml += `<div class="results-bar-seg ${cat.key === 'guiltFree' ? 'guilt-free' : cat.key}" style="width:0%" data-target="${budgetWeights[cat.key]}"></div>`;
            });
            body.innerHTML = `
                <div class="quiz-results">
                    <h3>Your Budget Blueprint</h3>
                    <p class="quiz-results-subtitle">Based on your lifestyle & goals</p>
                    <div class="results-ring-grid">${ringsHtml}</div>
                    <div class="results-bars-mini">${barsHtml}</div>
                    <button class="quiz-apply-btn" onclick="applyWeights()">
                        Apply & Continue <i class="fas fa-arrow-right"></i>
                    </button><br>
                    <button class="retake-btn" onclick="initQuiz()"><i class="fas fa-redo"></i> Retake Quiz</button>
                </div>`;

            requestAnimationFrame(() => {
                document.querySelectorAll('.result-ring-fill').forEach(c => {
                    const target = c.getAttribute('data-target');
                    c.style.strokeDashoffset = target;
                });
                document.querySelectorAll('.results-bar-seg').forEach(b => {
                    b.style.width = b.getAttribute('data-target') + '%';
                });
                document.querySelectorAll('.result-ring-pct').forEach(el => {
                    animateCounter(el, 0, parseInt(el.getAttribute('data-target')), 800);
                });
            });
        }
        
        function makeRing(pct, color) {
            const r = 38;
            const circ = 2 * Math.PI * r;
            const offset = circ - (pct / 100) * circ;
            return `<svg class="result-ring-svg" viewBox="0 0 90 90"><circle class="result-ring-bg" cx="45" cy="45" r="${r}"/><circle class="result-ring-fill" cx="45" cy="45" r="${r}" stroke="${color}" stroke-dasharray="${circ}" stroke-dashoffset="${circ}" data-target="${offset}"/></svg>`;
        }

        function animateCounter(el, from, to, duration) {
            const start = performance.now();
            (function tick(now) {
                const p = Math.min((now - start) / duration, 1);
                el.textContent = Math.round(from + (to - from) * (1 - Math.pow(1 - p, 3))) + '%';
                if (p < 1) requestAnimationFrame(tick);
            })(start);
        }

        function applyWeights() {
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('budgetContent').classList.add('visible');
            salaryProfitInput.value = '';
            updateUI();
            addPercentageInputListeners();
        }

        // ============ BUDGET LOGIC & UI UPDATES ============
        const salaryProfitInput = document.getElementById('salaryProfit');
        let pieChart;

        function formatCurrency(amount) {
            return `$${amount.toFixed(2)}`;
        }
        
        function rebalanceWeights(changedKey, newValue) {
            newValue = Math.round(Math.max(0, Math.min(100, newValue)));
            let oldValue = budgetWeights[changedKey];
            let diff = newValue - oldValue;
            
            if (diff === 0) return;

            budgetWeights[changedKey] = newValue;
            
            let otherKeys = CATEGORY_META.map(c => c.key).filter(k => k !== changedKey);
            let totalOtherWeights = otherKeys.reduce((sum, k) => sum + budgetWeights[k], 0);
            
            let remainderToDistribute = -diff;
            
            if (totalOtherWeights > 0) {
                for (let key of otherKeys) {
                    let proportion = budgetWeights[key] / totalOtherWeights;
                    budgetWeights[key] += remainderToDistribute * proportion;
                }
            } else if (otherKeys.length > 0) {
                let equalShare = remainderToDistribute / otherKeys.length;
                for (let key of otherKeys) {
                    budgetWeights[key] += equalShare;
                }
            }
            
            let currentTotal = CATEGORY_META.reduce((sum, c) => sum + budgetWeights[c.key], 0);
            let roundingError = 100 - currentTotal;
            
            if (roundingError !== 0) {
                const largestOtherKey = otherKeys.reduce((a, b) => budgetWeights[a] > budgetWeights[b] ? a : b, otherKeys[0]);
                if (largestOtherKey) {
                    budgetWeights[largestOtherKey] += roundingError;
                } else {
                    budgetWeights[changedKey] += roundingError;
                }
            }

            CATEGORY_META.forEach(cat => {
                budgetWeights[cat.key] = Math.max(0, Math.round(budgetWeights[cat.key]));
            });

             // Final pass to ensure it's exactly 100
            currentTotal = CATEGORY_META.reduce((sum, c) => sum + budgetWeights[c.key], 0);
            if (currentTotal !== 100) {
                 budgetWeights[changedKey] += (100 - currentTotal);
            }
        }


        function updateUI() {
            const salary = parseFloat(salaryProfitInput.value) || 0;
            const keys = CATEGORY_META.map(c => c.key);

            CATEGORY_META.forEach(cat => {
                const perc = budgetWeights[cat.key];
                const amount = (perc / 100) * salary;
                
                document.querySelector(`.percentage-input[data-key="${cat.key}"]`).value = perc.toFixed(0);
                document.getElementById(`${cat.key}-amount`).textContent = salary > 0 ? formatCurrency(amount) : '';
            });

            if (!pieChart) {
                createChart();
            }
            pieChart.data.labels = CATEGORY_META.map(c => `${c.name} (${budgetWeights[c.key].toFixed(0)}%)`);
            pieChart.data.datasets[0].data = keys.map(k => budgetWeights[k]);
            pieChart.options.plugins.datalabels.formatter = (value) => `${value.toFixed(0)}%`;
            pieChart.update();
        }

        function createChart() {
            if (pieChart) pieChart.destroy();
            const pieChartCanvas = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(pieChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: CATEGORY_META.map(c => `${c.name} (${budgetWeights[c.key].toFixed(0)}%)`),
                    datasets: [{
                        data: CATEGORY_META.map(c => budgetWeights[c.key]),
                        backgroundColor: CATEGORY_META.map(c => c.color),
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 16, family: 'Montserrat' },
                            bodyFont: { size: 14, family: 'Montserrat' },
                            padding: 12,
                            cornerRadius: 8
                        },
                        datalabels: {
                            color: '#fff',
                            font: { weight: 'bold', size: 14, family: 'Montserrat' },
                             formatter: (value) => `${value.toFixed(0)}%`
                        }
                    },
                    animation: { animateRotate: true, animateScale: true }
                }
            });
        }
        
        function addPercentageInputListeners() {
            document.querySelectorAll('.percentage-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const key = e.target.getAttribute('data-key');
                    const value = parseFloat(e.target.value);
                    rebalanceWeights(key, value);
                    updateUI();
                });
            });
        }

        salaryProfitInput.addEventListener('input', () => updateUI());
        
        (function() {
            const inputSection = document.querySelector('.input-section .glass-card');
            if (inputSection) {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                div.innerHTML = '<button class="retake-btn" onclick="initQuiz()"><i class="fas fa-redo"></i> Retake Quiz</button>';
                inputSection.appendChild(div);
            }
        })();

        // Initialize
        createChart();
        initQuiz();
    </script>
    
    <script>
        // ============ DYNAMIC BUDGET ADJUSTMENT LOGIC ============
        let pieChart; // Declared globally

        function rebalanceWeights(changedKey, newValue) {
            newValue = Math.max(0, Math.min(100, newValue));
            let oldValue = budgetWeights[changedKey];
            let diff = newValue - oldValue;
            
            if (diff === 0) return;

            // Calculate available percentage to distribute among other categories
            let otherKeys = CATEGORY_META.map(c => c.key).filter(k => k !== changedKey);
            let currentTotalOtherWeights = otherKeys.reduce((sum, k) => sum + budgetWeights[k], 0);

            if (currentTotalOtherWeights - diff < 0) {
                // Cannot take more than available, cap newValue to prevent negative percentages
                newValue = oldValue + currentTotalOtherWeights;
                diff = newValue - oldValue;
            }

            budgetWeights[changedKey] = newValue;
            
            let remainderToDistribute = -diff; // The amount to add/subtract from other categories

            if (currentTotalOtherWeights > 0) {
                for(let key of otherKeys) {
                    let proportion = budgetWeights[key] / currentTotalOtherWeights;
                    budgetWeights[key] += remainderToDistribute * proportion;
                }
            } else if (otherKeys.length > 0) { // If other weights are all zero, distribute equally
                const amountPerKey = remainderToDistribute / otherKeys.length;
                for(let key of otherKeys) {
                    budgetWeights[key] += amountPerKey;
                }
            }

            // Round to nearest integer and ensure total is 100 due to floating point inaccuracies
            CATEGORY_META.forEach(cat => {
                budgetWeights[cat.key] = Math.round(budgetWeights[cat.key]);
            });
            let totalAfterRounding = CATEGORY_META.reduce((sum, c) => sum + budgetWeights[c.key], 0);
            if (totalAfterRounding !== 100) {
                let largestKey = changedKey; // Give/take from the one user is editing
                if(Math.abs(100 - totalAfterRounding) > 0) {
                    budgetWeights[largestKey] += (100 - totalAfterRounding);
                }
            }
            
            // Ensure no category drops below 0 or goes above 100 due to rounding adjustments
            CATEGORY_META.forEach(cat => {
                budgetWeights[cat.key] = Math.max(0, Math.min(100, budgetWeights[cat.key]));
            });
        }

        function updateUI() {
            const salary = parseFloat(document.getElementById('salaryProfit').value) || 0;
            const keys = CATEGORY_META.map(c => c.key);

            CATEGORY_META.forEach(cat => {
                const perc = budgetWeights[cat.key];
                const amount = (perc / 100) * salary;
                
                const input = document.querySelector(`.percentage-input[data-key="${cat.key}"]`);
                if (input) input.value = perc.toFixed(0);

                const amountEl = document.getElementById(`${cat.key}-amount`);
                if(amountEl) amountEl.textContent = salary > 0 ? formatCurrency(amount) : '';
            });

            if (pieChart) { // Check if pieChart is initialized before updating
                pieChart.data.labels = CATEGORY_META.map(c => `${c.name} (${budgetWeights[c.key].toFixed(0)}%)`);
                pieChart.data.datasets[0].data = keys.map(k => budgetWeights[k]);
                pieChart.options.plugins.datalabels.formatter = (value) => `${value.toFixed(0)}%`;
                pieChart.update();
            }
        }

        function createChart() {
            if (pieChart) pieChart.destroy(); // Destroy existing chart if it exists
            const pieChartCanvas = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(pieChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: CATEGORY_META.map(c => c.color),
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 16, family: 'Montserrat' },
                            bodyFont: { size: 14, family: 'Montserrat' },
                            padding: 12,
                            cornerRadius: 8
                        },
                        datalabels: {
                            color: '#fff',
                            font: { weight: 'bold', size: 14, family: 'Montserrat' },
                        }
                    },
                    animation: { animateRotate: true, animateScale: true }
                }
            });
        }
        
        function addPercentageInputListeners() {
            document.querySelectorAll('.percentage-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const key = e.target.getAttribute('data-key');
                    const value = parseFloat(e.target.value);
                    rebalanceWeights(key, value);
                });
            });
        }
    </script>